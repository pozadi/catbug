/*! catbug 0.2.2
 *  2013-11-03 17:04:10 +0400
 *  http://github.com/pozadi/catbug
 */
(function(t,e,n){var r;t.catbug=r=function(){return r.core.module.apply(r,arguments)},r.ns=function(t,e){var n,r,i,o,u;for(n=this,u=t.split("."),i=0,o=u.length;o>i;i++)r=u[i],r&&(n=n[r]||(n[r]={}));return e(n,this)},r.ns("treeParser",function(t){var r,i;return t.regExps={nonEmpty:/\S+/,indentation:/^\s+/,selectorAndAttrs:/^([^\{]+)(?:\{(.*?)\})?$/,attribute:/([a-z_-]+)(?:=(?:"(.*?)"|'(.*?)'|(\S+)))?/,comments:/\/\*[\s\S]*?\*\/|\/\/.*/g},t.regExps.attributes=RegExp(t.regExps.attribute.source,"g"),r=function(e){var n;return(null!=(n=t.regExps.indentation.exec(e))?n[0].length:void 0)||0},i=function(e){return t.regExps.nonEmpty.test(e)},t.TreeNode=function(){function t(t){this.data=null!=t?t:null,this.children=[]}return t.prototype.append=function(t){return t.parent=this,this.children.push(t)},t}(),t.parseTree=function(o){var u,s,l,a,c,f,p,h,d,g,m,y,b,v,x;if(o=o.replace(t.regExps.comments,""),d=o.split("\n"),d=n.filter(d,i),0===d.length)return{roots:[],flat:[]};for(s=new t.TreeNode,m=s.children,u=r(d[0]),f=null,a=[],c=null,y=0,v=d.length;v>y;y++){if(h=d[y],p=r(h),p>u){if(null===c&&(c=p-u),p-u!==c)throw Error("wrong ident step");s=f}if(u>p){if(null===c)throw Error("unexpected indent");if(l=u-p,0!==l%c)throw Error("wrong ident step");for(;l>=c;)if(l-=c,s=s.parent,null===s)throw Error("unexpected indent")}u=p,f=new t.TreeNode(e.trim(h)),s.append(f),a.push(f)}for(b=0,x=m.length;x>b;b++)g=m[b],g.parent=null;return{roots:m,flat:a}},t.parseLine=function(n){var r;if(r=t.regExps.selectorAndAttrs.exec(n),!r)throw Error("wrong syntax");return{selector:e.trim(r[1]),attributes:t.parseAttributes(r[2])}},t.parseAttributes=function(e){var n,r,i,o,u,s,l,a;if(i={},e)for(a=e.match(t.regExps.attributes),s=0,l=a.length;l>s;s++)n=a[s],o=t.regExps.attribute.exec(n),r=o[1],u=o[4]||o[3]||o[2],i[r]=u;return i},t.parse=function(e){var r,i,o,u,s;for(i=t.parseTree(e).flat,s=[],o=0,u=i.length;u>o;o++)r=i[o],s.push(n.extend(r,t.parseLine(r.data)));return s}}),r.ns("elementMeta",function(t,r){return t.selectorToName=function(t){return e.camelCase(t.replace(/[^a-z0-9]+/gi,"-").replace(/^-/,"").replace(/-$/,"").replace(/^js-/,""))},t.getName=function(e){return e.attributes.name?e.attributes.name:t.selectorToName(e.selector)},t.getInfos=function(e){var i,o,u,s,l,a,c;for(o=r.treeParser.parse(e),l=0,a=o.length;a>l;l++)i=o[l],i.selector=i.selector.replace("&",null!=(c=i.parent)?c.selector:void 0),i.name=t.getName(i),i.global="global"in i.attributes;if(0===o.length)throw Error("there is no elements");if(s=n.filter(o,function(t){return null===t.parent&&!t.global}),s.length>1)throw Error("more than one root");return u=s[0],{root:u,elements:n.without(o,u)}}}),r.ns("core",function(t){return jQuery.prototype.catbug=function(e){var n;return n=this.get(0),n?t.instances[e].init(n):void 0}}),r.ns("jquerySub",function(t){t.sub=function(){function t(e,n){return new t.fn.init(e,n)}e.extend(!0,t,e),t.superclass=e,t.fn=t.prototype=e(),t.fn.constructor=t,t.fn.init=function(r,i){return i&&i instanceof jQuery&&!(i instanceof t)&&(i=t(i)),e.fn.init.call(this,r,i,n)},t.fn.init.prototype=t.fn;var n=t(document);return t}}),r.ns("builderContext",function(t){var e;return e=function(){function t(t,e){this.el=t,this.root=e,this.el.root=this.root}return t.prototype.update=function(t){var e,r,i,o;for(n.isString(t)&&(t=t.split(" ")),o=[],r=0,i=t.length;i>r;r++)e=t[r],o.push(this.el[e].update());return o},t.prototype.updateAll=function(){var t,e,n,r,i;for(r=this.el,i=[],e=0,n=r.length;n>e;e++)t=r[e],i.push(t.update());return i},t}(),t.create=function(t,n){return new e(n,t)}}),r.ns("element",function(r,i){var o;return o=function(t){return t.jquery?t.get(0):t},r.jQuery=i.jquerySub.sub(),r.jQuery.prototype.update=function(){var t,n,r,i;for(this.splice(0,this.length),i=e(this.selector,this.context),n=0,r=i.length;r>n;n++)t=i[n],this.push(t);return this},r.jQuery.prototype.byChild=function(t){return t=o(t),this.filter(function(){return e.contains(this,t)})},r.jQuery.prototype.byParent=function(t){return t=o(t),this.filter(function(){return e.contains(t,this)})},r.jQuery.prototype.live=function(t,n,r){return e(this.context).on(t,this.selector,n,r),this},r.jQuery.prototype.die=function(t,n){return e(this.context).off(t,this.selector,n),this},r.create=function(e,i){var o,u;return u=e.selector,o=e.global?t.document:i,n.extend(r.jQuery(u,o),{selector:u,context:o,info:e})}});var i=function(t,e){return function(){return t.apply(e,arguments)}};r.ns("core",function(t,r){return t.instances={},t.Module=function(){function t(t,e,n,r){this.name=t,this.rootSelector=e,this.elements=n,this.builder=r,this.initAll=i(this.initAll,this)}return t.prototype._buildElements=function(t){var e,n,i,o,u;for(n={},u=this.elements,i=0,o=u.length;o>i;i++)e=u[i],n[e.name]=r.element.create(e,t);return n},t.prototype.init=function(t){var n,i;return t=e(t),i="catbug-"+this.name,t.data(i)||(n=r.builderContext.create(t,this._buildElements(t)),t.data(i,this.builder.call(n,n))),t.data(i)},t.prototype.initAll=function(){var t,n,r,i,o;for(i=e(this.rootSelector),o=[],n=0,r=i.length;r>n;n++)t=i[n],o.push(this.init(t));return o},t}(),t.module=function(i,o,u){var s,l;return null==u&&(u=o,o=n.uniqueId("lambda-")),s=r.elementMeta.getInfos(i),t.instances[o]=l=new t.Module(o,s.root.selector,s.elements,u),e(l.initAll),l},r.init=function(e){var r,i,o,u;for(n.isString(e)&&(e=e.split(" ")),i={},o=0,u=e.length;u>o;o++)r=e[o],i[r]=t.instances[r].initAll();return i},r.initAll=function(){var e,n,r,i;r={},i=t.instances;for(n in i)e=i[n],r[n]=e.initAll();return r}})})(this,this.jQuery,this._);